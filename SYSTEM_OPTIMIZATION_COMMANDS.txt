# VPS System Optimization Commands for 4 vCPU / 6GB RAM
# Run these on your VPS to optimize for 300+ concurrent users

# 1. Increase file descriptor limits
echo "* soft nofile 65535" >> /etc/security/limits.conf
echo "* hard nofile 65535" >> /etc/security/limits.conf
echo "root soft nofile 65535" >> /etc/security/limits.conf
echo "root hard nofile 65535" >> /etc/security/limits.conf

# 2. Network performance tuning
sysctl -w net.core.somaxconn=65535
sysctl -w net.core.netdev_max_backlog=4096
sysctl -w net.ipv4.tcp_fin_timeout=15
sysctl -w net.ipv4.tcp_tw_reuse=1
sysctl -w net.ipv4.ip_local_port_range="10240 65000"
sysctl -w net.ipv4.tcp_max_syn_backlog=4096
sysctl -w net.core.rmem_max=67108864
sysctl -w net.core.wmem_max=67108864

# Make permanent
cat >> /etc/sysctl.conf << EOF
net.core.somaxconn=65535
net.core.netdev_max_backlog=4096
net.ipv4.tcp_fin_timeout=15
net.ipv4.tcp_tw_reuse=1
net.ipv4.ip_local_port_range=10240 65000
net.ipv4.tcp_max_syn_backlog=4096
net.core.rmem_max=67108864
net.core.wmem_max=67108864
EOF

# 3. Create logs directory for PM2
mkdir -p /var/www/sentientm/Accountmanager/logs

# 4. Apply new PM2 configuration
cd /var/www/sentientm/Accountmanager
pm2 delete all
pm2 start PM2_VPS_OPTIMIZATION.js
pm2 save

# 5. Restart NGINX with new configuration (after updating config file)
nginx -t
systemctl restart nginx

# 6. Monitor performance
pm2 monit
