<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Console Debug</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Facebook Console Debug</h1>
    <div id="status">Testing...</div>
    <div id="results"></div>
    <div id="console-output"></div>

    <script>
        // Capture console logs
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        
        const consoleOutput = document.getElementById('console-output');
        
        function addToConsole(type, ...args) {
            const timestamp = new Date().toISOString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            consoleOutput.innerHTML += `<div style="color: ${type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black'}">
                <strong>[${timestamp}] ${type.toUpperCase()}:</strong> ${message}
            </div>`;
        }
        
        console.log = (...args) => {
            originalConsoleLog.apply(console, args);
            addToConsole('log', ...args);
        };
        
        console.error = (...args) => {
            originalConsoleError.apply(console, args);
            addToConsole('error', ...args);
        };
        
        console.warn = (...args) => {
            originalConsoleWarn.apply(console, args);
            addToConsole('warn', ...args);
        };
        
        async function testFacebookFrontend() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            try {
                console.log('üîç Starting Facebook frontend debug test...');
                
                // Simulate the exact call the frontend makes
                const facebookPageId = '681487244693083';
                const url = `/events-list/${facebookPageId}?platform=facebook&t=${Date.now()}`;
                
                console.log(`üì° Making API call to: ${url}`);
                
                const response = await axios.get(url, {
                    timeout: 10000
                });
                
                console.log('‚úÖ API call successful');
                console.log(`üìä Response data length: ${response.data.length}`);
                console.log('üìã Response data:', response.data);
                
                if (response.data && Array.isArray(response.data)) {
                    const facebookNotifications = response.data.map((notif) => ({
                        ...notif,
                        platform: 'facebook',
                        facebook_page_id: facebookPageId,
                        text: notif.text || '',
                        timestamp: notif.timestamp || Date.now(),
                        status: notif.status || 'pending'
                    }));
                    
                    console.log('üîÑ Processed notifications:', facebookNotifications);
                    console.log(`üìà Final count: ${facebookNotifications.length} notifications`);
                    
                    resultsDiv.innerHTML = `
                        <h3>‚úÖ Test Results:</h3>
                        <p><strong>API Call:</strong> ‚úÖ Successful</p>
                        <p><strong>Response:</strong> ${response.data.length} notifications</p>
                        <p><strong>Processing:</strong> ‚úÖ ${facebookNotifications.length} processed</p>
                        <p><strong>Status:</strong> All notifications should be displayed</p>
                    `;
                    
                    statusDiv.textContent = '‚úÖ Frontend should be working!';
                    
                } else {
                    console.error('‚ùå Invalid response format:', response.data);
                    resultsDiv.innerHTML = `
                        <h3>‚ùå Test Failed:</h3>
                        <p><strong>Error:</strong> Invalid response format</p>
                        <p><strong>Response:</strong> ${JSON.stringify(response.data)}</p>
                    `;
                    statusDiv.textContent = '‚ùå Invalid response format';
                }
                
            } catch (error) {
                console.error('‚ùå API call failed:', error);
                statusDiv.textContent = '‚ùå Error occurred';
                resultsDiv.innerHTML = `
                    <h3>‚ùå Error:</h3>
                    <pre>${error.message}</pre>
                    <p>Response: ${error.response?.data || 'No response data'}</p>
                `;
            }
        }
        
        // Run test when page loads
        testFacebookFrontend();
    </script>
</body>
</html> 